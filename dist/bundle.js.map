{"version":3,"sources":["webpack:///webpack/bootstrap 4067b31f10d1cb877e1a","webpack:///./src/test.js","webpack:///./test/applyMiddleware.js","webpack:///./src/index.js"],"names":["require","initState","a","b","c","REDUCE_1","reducer","state","action","type","playload","logger","store","console","log","getState","next","promiseMiddleware","then","result","dispatch","error","Promise","reject","subsribe","$dispatch","resolve","setTimeout","createStore","applyMiddleware","listeners","forEach","listener","push","filter","l","combineReducer","reducers","Object","keys","key","middlewares","mds","concat","reverse","map","m","reduce","previous","current"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;ACtCA;AACA;AACA,oBAAAA,CAAQ,CAAR,E;;;;;;;;;;ACFA;;AAEA,KAAIC,YAAY;AACdC,MAAG,CADW;AAEdC,MAAG,CAFW;AAGdC,MAAG,CAHW;AAIdC,aAAU;AAJI,EAAhB;;AAOA,KAAIC,UAAU,SAAVA,OAAU,CAAUC,KAAV,EAAiBC,MAAjB,EAAyB;AACrC,WAAQA,OAAOC,IAAf;AACE,UAAK,UAAL;AACEF,aAAMF,QAAN;AACA,cAAOE,KAAP;AACF,UAAK,MAAL;AACEA,aAAMF,QAAN,IAAkBG,OAAOE,QAAzB;AACA,cAAOH,KAAP;AACF;AACE,cAAOA,KAAP;AARJ;AAUD,EAXD;;AAaA;AACA,KAAII,SAAS,SAATA,MAAS,CAACC,KAAD;AAAA,UAAW;AAAA,YAAQ,kBAAU;AACxC;AACAC,eAAQC,GAAR,CAAY,WAAZ,EAAyBF,MAAMG,QAAN,EAAzB;AACAC,YAAKR,MAAL;AACAK,eAAQC,GAAR,CAAY,WAAZ,EAAyBF,MAAMG,QAAN,EAAzB;AACD,MALuB;AAAA,IAAX;AAAA,EAAb;;AAOA,KAAIE,oBAAoB,SAApBA,iBAAoB;AAAA,UAAS;AAAA,YAAQ,kBAAU;AACjD,WAAIT,OAAOE,QAAP,CAAgBQ,IAApB,EAA0B;AACxBV,gBAAOE,QAAP,CAAgBQ,IAAhB,CACE,kBAAU;AACRF,gBAAKG,MAAL;AACD,UAHH,EAIE,iBAAS;AACPP,iBAAMQ,QAAN,cAAmBZ,MAAnB,IAA2BE,UAAUW,KAArC;AACA,kBAAOC,QAAQC,MAAR,CAAeF,KAAf,CAAP;AACD,UAPH;AAQD,QATD,MASO;AACLL,cAAKR,MAAL;AACD;AACF,MAbgC;AAAA,IAAT;AAAA,EAAxB;;AAeA,KAAII,QAAQ,sBACVN,OADU,EAEVL,SAFU,EAGV,0BAAgBgB,iBAAhB,EAAmCN,MAAnC,CAHU,CAAZ;;AAMAC,OAAMY,QAAN,CAAe,YAAY;AACzBX,WAAQC,GAAR,CAAY,oBAAZ,EAAkCF,MAAMG,QAAN,EAAlC;AACD,EAFD;;AAIAH,OAAMa,SAAN,CAAgB;AACdf,aAAU,IAAIY,OAAJ,CAAY,UAACI,OAAD,EAAUH,MAAV,EAAqB;AACzCI,gBAAW,YAAM;AACfD,eAAQ;AACNjB,eAAM,MADA;AAENC,mBAAU;AAFJ,QAAR;AAID,MALD,EAKG,IALH;AAMD,IAPS;AADI,EAAhB;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,W;;;;;;;;;;;ACxEO,KAAIkB,oCAAc,SAAdA,WAAc,CAAUtB,OAAV,EAAoD;AAAA,OAAjCL,SAAiC,uEAArB,EAAqB;AAAA,OAAjB4B,eAAiB;;AAC3E,OAAItB,QAAQN,SAAZ;AACA,OAAI6B,YAAY,EAAhB;AACA,OAAIV,WAAW,SAAXA,QAAW,CAAUZ,MAAV,EAAkB;AAC/BD,aAAQD,QAAQC,KAAR,EAAeC,MAAf,CAAR;AACAsB,eAAUC,OAAV,CAAkB;AAAA,cAAYC,UAAZ;AAAA,MAAlB;AACD,IAHD;AAIA,OAAIP,YAAY,SAAZA,SAAY,CAAUjB,MAAV,EAAkB;AAChCqB,qBAAgB;AACdT,yBADc;AAEdL;AAFc,MAAhB,EAGGP,MAHH;AAID,IALD;;AAOA,OAAIgB,WAAW,SAAXA,QAAW,CAAUQ,QAAV,EAAoB;AACjCF,eAAUG,IAAV,CAAeD,QAAf;AACA,YAAO,YAAM;AACXF,mBAAYA,UAAUI,MAAV,CAAiB;AAAA,gBAAKC,MAAMH,QAAX;AAAA,QAAjB,CAAZ;AACD,MAFD;AAGD,IALD;AAMA,OAAIjB,WAAW,SAAXA,QAAW,GAAY;AACzB,YAAOR,KAAP;AACD,IAFD;AAGA,UAAO;AACLa,uBADK;AAELK,yBAFK;AAGLD,uBAHK;AAILT;AAJK,IAAP;AAMD,EA7BM;AA8BP;AACA;AACO,KAAIqB,0CAAiB,SAASA,cAAT,CAAyBC,QAAzB,EAAmC;AAC7D,UAAO,UAAC9B,KAAD,EAAQC,MAAR,EAAmB;AACxB8B,YAAOC,IAAP,CAAYF,QAAZ,EAAsBN,OAAtB,CAA8B,eAAO;AACnCxB,aAAMiC,GAAN,IAAaH,SAASG,GAAT,EAAcjC,MAAMiC,GAAN,CAAd,EAA0BhC,MAA1B,CAAb;AACD,MAFD;AAGA,YAAOD,KAAP;AACD,IALD;AAMD,EAPM;;AASP;AACO,KAAIsB,4CAAkB,SAASA,eAAT,GAA0C;AAAA,qCAAbY,WAAa;AAAbA,gBAAa;AAAA;;AACrE,UAAO,UAAC7B,KAAD,EAAQJ,MAAR,EAAmB;AACxB;AACA;AACA,SAAIkC,MAAM,GAAGC,MAAH,CAAUF,WAAV,EAAuBG,OAAvB,GAAiCC,GAAjC,CAAqC;AAAA,cAAKC,EAAElC,KAAF,CAAL;AAAA,MAArC,CAAV;AACA8B,SAAIK,MAAJ,CAAW,UAACC,QAAD,EAAWC,OAAX,EAAuB;AAChC,cAAOA,QAAQD,QAAR,CAAP;AACD,MAFD,EAEGpC,MAAMQ,QAFT,EAEmBZ,MAFnB;AAGD,IAPD;AAQD,EATM,C","file":"./dist/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 4067b31f10d1cb877e1a\n **/","// require('../test/mydux')\n// require('../test/combineReducer')\nrequire('../test/applyMiddleware')\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/test.js\n **/","import { createStore, applyMiddleware } from '../src'\n\nvar initState = {\n  a: 1,\n  b: 2,\n  c: 3,\n  REDUCE_1: 10\n}\n\nvar reducer = function (state, action) {\n  switch (action.type) {\n    case 'REDUCE_1':\n      state.REDUCE_1++\n      return state\n    case 'Sync':\n      state.REDUCE_1 += action.playload\n      return state\n    default:\n      return state\n  }\n}\n\n// 注意action是否可以修改咧，比如支持promise的action\nvar logger = (store) => next => action => {\n  // console.log(action)\n  console.log('开始接受之前的状态', store.getState())\n  next(action)\n  console.log('结束接受之后的状态', store.getState())\n}\n\nvar promiseMiddleware = store => next => action => {\n  if (action.playload.then) {\n    action.playload.then(\n      result => {\n        next(result)\n      },\n      error => {\n        store.dispatch({...action, playload: error})\n        return Promise.reject(error)\n      })\n  } else {\n    next(action)\n  }\n}\n\nvar store = createStore(\n  reducer,\n  initState,\n  applyMiddleware(promiseMiddleware, logger)\n )\n\nstore.subsribe(function () {\n  console.log('we got new state: ', store.getState())\n})\n\nstore.$dispatch({\n  playload: new Promise((resolve, reject) => {\n    setTimeout(() => {\n      resolve({\n        type: 'Sync',\n        playload: 23333\n      })\n    }, 2000)\n  })\n})\n// var idx = 0\n// var interval = setInterval(function () {\n//   var i = idx++\n//\n//   if (idx > 2) {\n//     clearInterval(interval)\n//   }\n// }, 500)\n\n\n\n/** WEBPACK FOOTER **\n ** ./test/applyMiddleware.js\n **/","export var createStore = function (reducer, initState = {}, applyMiddleware) {\n  var state = initState\n  var listeners = []\n  var dispatch = function (action) {\n    state = reducer(state, action)\n    listeners.forEach(listener => listener())\n  }\n  var $dispatch = function (action) {\n    applyMiddleware({\n      dispatch,\n      getState\n    }, action)\n  }\n\n  var subsribe = function (listener) {\n    listeners.push(listener)\n    return () => {\n      listeners = listeners.filter(l => l !== listener)\n    }\n  }\n  var getState = function () {\n    return state\n  }\n  return {\n    dispatch,\n    $dispatch,\n    subsribe,\n    getState\n  }\n}\n// 返回一个大大的reducer\n// 有个约定就是，reducer的属性名需要与state的属性名一致\nexport var combineReducer = function combineReducer (reducers) {\n  return (state, action) => {\n    Object.keys(reducers).forEach(key => {\n      state[key] = reducers[key](state[key], action)\n    })\n    return state\n  }\n}\n\n// export var applyMiddleware = function applyMiddleware (middleware1， middleware2) {\nexport var applyMiddleware = function applyMiddleware (...middlewares) {\n  return (store, action) => {\n    // middleware1(middleware2(dispatch))(action)\n    // 如果倒叙的话就不用这样转了\n    var mds = [].concat(middlewares).reverse().map(m => m(store))\n    mds.reduce((previous, current) => {\n      return current(previous)\n    }, store.dispatch)(action)\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/"],"sourceRoot":""}